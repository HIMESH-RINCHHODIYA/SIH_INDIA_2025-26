{% extends "base.html" %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<h2 class="text-center mb-4">ðŸ“˜ Courses (Faculty View)</h2>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- Assign Faculty to a Course -->
<div class="card shadow mb-4">
  <div class="card-header bg-primary text-white">Assign Yourself to a Course</div>
  <div class="card-body">
    <form method="POST" action="{{ url_for('course_bp.faculty_courses') }}">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label" for="course_id">Select Course</label>
          <select class="form-select" name="course_id" id="course_id" required>
            <option value="" disabled selected>-- Choose a Course --</option>
            {% for c in courses %}
              <option value="{{ c.id }}">{{ c.course_name }} ({{ c.course_code }})</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label" for="course_type">Type</label>
          <select class="form-select" name="course_type" id="course_type" required>
            <option value="Theory">ðŸ“˜ Theory</option>
            <option value="Lab">ðŸ§ª Lab</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col-md-3 mb-3">
          <label class="form-label" for="program">Program</label>
          <select class="form-select" name="program" id="program" required></select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label" for="branch">Branch</label>
          <select class="form-select" name="branch" id="branch" required></select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label" for="year">Year</label>
          <select class="form-select" name="year" id="year" required></select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label" for="semester">Semester</label>
          <select class="form-select" name="semester" id="semester" required></select>
        </div>
      </div>

      <button type="submit" class="btn btn-success">âœ… Assign</button>
    </form>
  </div>
</div>

<!-- Assigned Courses Table -->
<div class="card shadow">
  <div class="card-header bg-dark text-white">My Assigned Courses</div>
  <div class="table-responsive">
    <table class="table table-striped mb-0" id="courseTable">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Course Name</th>
          <th>Course Code</th>
          <th>Type</th>
          <th>Program</th>
          <th>Branch</th>
          <th>Year</th>
          <th>Semester</th>
        </tr>
      </thead>
      <tbody id="courseTableBody">
        {% for a in assigned %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ a.course.course_name }}</td>
          <td>{{ a.course.course_code }}</td>
          <td>{{ a.course_type }}</td>
          <td>{{ a.program }}</td>
          <td>{{ a.branch }}</td>
          <td>{{ a.year }}</td>
          <td>{{ a.semester }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="8" class="text-center text-muted">No courses assigned yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function fillSelect(id, arr) {
  const sel = document.getElementById(id);
  sel.innerHTML = '<option value="" disabled selected>-- Select --</option>';
  arr.forEach(v => {
    const o = document.createElement('option');
    o.value = v;
    o.textContent = v;
    sel.appendChild(o);
  });
}

async function loadDropdowns() {
  try {
    const res = await fetch("/api/dropdowns");  // âœ… get admin-defined values
    const data = await res.json();

    fillSelect("program", data.program || []);
    fillSelect("branch", data.branch || []);
    fillSelect("year", data.year || []);
    fillSelect("semester", data.semester || []);
  } catch (err) {
    console.error("Failed to load dropdowns:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadDropdowns);
</script>
{% endblock %}
